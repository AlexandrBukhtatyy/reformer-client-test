# Тест-кейсы: Многошаговая форма заявки на кредит

**Версия:** 1.0
**Дата создания:** 2025-11-22
**Спецификация:** [complex-multi-step-form.md](complex-multi-step-form.md)

---

## Содержание

1. [Базовые сценарии (Happy Path)](#1-базовые-сценарии-happy-path)
2. [Валидация полей](#2-валидация-полей)
3. [Условные поля](#3-условные-поля-conditional-fields)
4. [Вычисляемые поля](#4-вычисляемые-поля-computed-fields)
5. [Зависимости и каскадные эффекты](#5-зависимости-и-каскадные-эффекты)
6. [Кросс-валидация](#6-кросс-валидация)
7. [Динамическая загрузка данных](#7-динамическая-загрузка-данных)
8. [Навигация между шагами](#8-навигация-между-шагами)
9. [Работа с массивами](#9-работа-с-массивами-arraynode)
10. [Обработка ошибок](#10-обработка-ошибок)
11. [Режимы формы](#11-режимы-формы)
12. [Edge Cases](#12-edge-cases)
13. [Производительность](#13-производительность-performance)
14. [Утечки памяти](#14-утечки-памяти-memory-leaks)

---

## 1. Базовые сценарии (Happy Path)

### TC-HP-001: Успешное заполнение формы потребительского кредита

**Приоритет:** Critical
**Категория:** Happy Path
**Предусловия:** Форма открыта в режиме создания (mode='create')

**Шаги:**

1. На шаге 1 выбрать тип кредита "Потребительский"
2. Ввести сумму кредита: 500000
3. Ввести срок кредита: 24 месяца
4. Ввести цель кредита: "Ремонт квартиры"
5. Перейти на шаг 2
6. Заполнить все персональные данные (ФИО, дата рождения, паспорт, ИНН, СНИЛС)
7. Перейти на шаг 3
8. Заполнить контактную информацию (телефон, email, адрес)
9. Перейти на шаг 4
10. Выбрать статус занятости "Работаю по найму"
11. Заполнить информацию о работодателе и доходе
12. Перейти на шаг 5
13. Заполнить семейное положение и образование
14. Перейти на шаг 6
15. Отметить все обязательные согласия
16. Ввести SMS-код подтверждения
17. Нажать "Отправить заявку"

**Ожидаемый результат:**

- Форма успешно отправлена
- Отображается сообщение об успешной отправке
- Все введенные данные сохранены корректно

**Тестовые данные:**

```json
{
  "loanType": "consumer",
  "loanAmount": 500000,
  "loanTerm": 24,
  "loanPurpose": "Ремонт квартиры",
  "personalData": {
    "lastName": "Иванов",
    "firstName": "Иван",
    "middleName": "Иванович",
    "birthDate": "1990-05-15",
    "gender": "male",
    "birthPlace": "г. Москва"
  },
  "phoneMain": "+7 (999) 123-45-67",
  "email": "ivanov@example.com",
  "monthlyIncome": 100000
}
```

---

### TC-HP-002: Успешное заполнение формы ипотеки

**Приоритет:** Critical
**Категория:** Happy Path
**Предусловия:** Форма открыта в режиме создания

**Шаги:**

1. На шаге 1 выбрать тип кредита "Ипотека"
2. Убедиться, что появились поля "Стоимость недвижимости" и "Первоначальный взнос"
3. Ввести стоимость недвижимости: 5000000
4. Убедиться, что первоначальный взнос автоматически рассчитан как 1000000 (20%)
5. Ввести сумму кредита: 4000000
6. Ввести срок: 240 месяцев
7. Заполнить все последующие шаги
8. Отправить заявку

**Ожидаемый результат:**

- Поля ипотеки отображаются корректно
- Первоначальный взнос рассчитан автоматически
- Заявка успешно отправлена

**Тестовые данные:**

```json
{
  "loanType": "mortgage",
  "propertyValue": 5000000,
  "initialPayment": 1000000,
  "loanAmount": 4000000,
  "loanTerm": 240
}
```

---

### TC-HP-003: Успешное заполнение формы автокредита

**Приоритет:** Critical
**Категория:** Happy Path
**Предусловия:** Форма открыта в режиме создания

**Шаги:**

1. На шаге 1 выбрать тип кредита "Автокредит"
2. Убедиться, что появились поля марки, модели, года и стоимости авто
3. Ввести марку автомобиля: "Toyota"
4. Дождаться загрузки моделей
5. Выбрать модель: "Camry"
6. Ввести год выпуска: 2023
7. Ввести стоимость автомобиля: 3000000
8. Заполнить все последующие шаги
9. Отправить заявку

**Ожидаемый результат:**

- Поля автокредита отображаются корректно
- Модели загружаются по выбранной марке
- Заявка успешно отправлена

**Тестовые данные:**

```json
{
  "loanType": "car",
  "carBrand": "Toyota",
  "carModel": "Camry",
  "carYear": 2023,
  "carPrice": 3000000,
  "loanAmount": 2500000,
  "loanTerm": 60
}
```

---

### TC-HP-004: Загрузка и редактирование существующей заявки

**Приоритет:** Critical
**Категория:** Happy Path
**Предусловия:** Существует заявка с ID='1'

**Шаги:**

1. Открыть форму с параметром applicationId='1'
2. Дождаться загрузки данных
3. Убедиться, что все поля предзаполнены данными заявки
4. Изменить сумму кредита
5. Перейти на последний шаг
6. Отправить форму

**Ожидаемый результат:**

- Форма загружена с предзаполненными данными
- Изменения сохранены успешно
- Все вычисляемые поля пересчитаны после изменения

---

### TC-HP-005: Режим просмотра заявки

**Приоритет:** High
**Категория:** Happy Path
**Предусловия:** Существует заявка, форма открыта в режиме mode='view'

**Шаги:**

1. Открыть форму в режиме просмотра
2. Попытаться изменить любое поле
3. Попытаться нажать кнопку отправки

**Ожидаемый результат:**

- Все поля заблокированы для редактирования (readonly)
- Кнопка отправки скрыта или заблокирована
- Навигация между шагами доступна для просмотра

---

## 2. Валидация полей

### TC-VAL-001: Блокировка перехода при пустых обязательных полях (Шаг 1)

**Приоритет:** Critical
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Оставить поле "Сумма кредита" пустым
2. Нажать кнопку "Далее"

**Ожидаемый результат:**

- Переход на следующий шаг заблокирован
- Поле "Сумма кредита" подсвечено как ошибочное
- Отображается сообщение об ошибке

---

### TC-VAL-002: Валидация минимальной суммы кредита

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Ввести сумму кредита: 10000 (меньше минимума 50000)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Минимальная сумма 50 000 ₽"
- Переход заблокирован

---

### TC-VAL-003: Валидация максимальной суммы кредита

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Ввести сумму кредита: 15000000 (больше максимума 10000000)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Максимальная сумма 10 000 000 ₽"
- Переход заблокирован

---

### TC-VAL-004: Валидация минимального срока кредита

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Ввести срок кредита: 3 месяца (меньше минимума 6)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Минимальный срок 6 месяцев"
- Переход заблокирован

---

### TC-VAL-005: Валидация максимального срока кредита

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Ввести срок кредита: 300 месяцев (больше максимума 240)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Максимальный срок 240 месяцев"
- Переход заблокирован

---

### TC-VAL-006: Валидация минимальной длины цели кредита

**Приоритет:** Medium
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Ввести цель кредита: "Ремонт" (9 символов, меньше минимума 10)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка о минимальной длине
- Переход заблокирован

---

### TC-VAL-007: Валидация формата email

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 3

**Шаги:**

1. Ввести email: "invalid-email"
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Некорректный формат email"
- Переход заблокирован

---

### TC-VAL-008: Валидация маски телефона

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 3

**Шаги:**

1. Ввести телефон: "123" (неполный номер)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Маска применена: "+7 (123) **\_-**-\_\_"
- Отображается ошибка о неполном номере
- Переход заблокирован

---

### TC-VAL-009: Валидация формата ИНН (12 цифр)

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести ИНН: "12345" (неполный)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка о формате ИНН
- Переход заблокирован

---

### TC-VAL-010: Валидация формата СНИЛС

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести СНИЛС: "123-456" (неполный)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Маска применена корректно
- Отображается ошибка о неполном СНИЛС
- Переход заблокирован

---

### TC-VAL-011: Валидация серии паспорта

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести серию паспорта: "12" (неполная)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Маска "99 99" применена
- Отображается ошибка о формате
- Переход заблокирован

---

### TC-VAL-012: Валидация кода подразделения

**Приоритет:** Medium
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести код подразделения: "123" (неполный)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Маска "999-999" применена
- Отображается ошибка о формате
- Переход заблокирован

---

### TC-VAL-013: Валидация минимального дохода

**Приоритет:** High
**Категория:** Валидация полей
**Предусловия:** Форма открыта на шаге 4

**Шаги:**

1. Ввести ежемесячный доход: 5000 (меньше минимума 10000)
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Минимальный доход 10 000 ₽"
- Переход заблокирован

---

### TC-VAL-014: Валидация обязательных согласий на шаге 6

**Приоритет:** Critical
**Категория:** Валидация полей
**Предусловия:** Форма заполнена до шага 6

**Шаги:**

1. Не отмечать чекбокс "Согласие на обработку персональных данных"
2. Нажать "Отправить заявку"

**Ожидаемый результат:**

- Отправка заблокирована
- Отображается ошибка о необходимости согласия

---

### TC-VAL-015: Валидация SMS-кода

**Приоритет:** Critical
**Категория:** Валидация полей
**Предусловия:** Форма заполнена до шага 6, все согласия отмечены

**Шаги:**

1. Ввести SMS-код: "123" (неполный, нужно 6 цифр)
2. Нажать "Отправить заявку"

**Ожидаемый результат:**

- Отправка заблокирована
- Отображается ошибка о неполном коде

---

## 3. Условные поля (Conditional Fields)

### TC-COND-001: Отображение полей ипотеки при выборе типа "Ипотека"

**Приоритет:** Critical
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Выбрать тип кредита "Потребительский"
2. Убедиться, что поля ипотеки скрыты
3. Выбрать тип кредита "Ипотека"

**Ожидаемый результат:**

- Появились поля: "Стоимость недвижимости", "Первоначальный взнос"
- Поля обязательны для заполнения

---

### TC-COND-002: Скрытие полей ипотеки при смене типа кредита

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Выбран тип "Ипотека", поля заполнены

**Шаги:**

1. Заполнить поля ипотеки (стоимость, взнос)
2. Сменить тип кредита на "Потребительский"

**Ожидаемый результат:**

- Поля ипотеки скрыты
- Значения полей сброшены

---

### TC-COND-003: Отображение полей автокредита

**Приоритет:** Critical
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Выбрать тип кредита "Автокредит"

**Ожидаемый результат:**

- Появились поля: "Марка автомобиля", "Модель", "Год выпуска", "Стоимость автомобиля"
- Поля обязательны для заполнения

---

### TC-COND-004: Скрытие полей автокредита при смене типа

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Выбран тип "Автокредит", поля заполнены

**Шаги:**

1. Заполнить поля автокредита
2. Сменить тип кредита на "Потребительский"

**Ожидаемый результат:**

- Поля автокредита скрыты
- Значения полей сброшены

---

### TC-COND-005: Отображение полей работодателя при статусе "Работаю по найму"

**Приоритет:** Critical
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 4

**Шаги:**

1. Выбрать статус занятости "Работаю по найму" (employed)

**Ожидаемый результат:**

- Появились поля: "Название компании", "ИНН компании", "Телефон компании", "Адрес компании", "Должность"
- Поля обязательны для заполнения

---

### TC-COND-006: Отображение полей ИП при статусе "Самозанятый/ИП"

**Приоритет:** Critical
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 4

**Шаги:**

1. Выбрать статус занятости "Самозанятый/ИП" (selfEmployed)

**Ожидаемый результат:**

- Появились поля: "Тип бизнеса", "ИНН ИП", "Вид деятельности"
- Поля обязательны для заполнения
- Поля работодателя скрыты

---

### TC-COND-007: Скрытие полей занятости при смене статуса

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Статус "Работаю по найму", поля заполнены

**Шаги:**

1. Сменить статус на "Безработный" (unemployed)

**Ожидаемый результат:**

- Поля работодателя скрыты
- Значения полей сброшены

---

### TC-COND-008: Отображение адреса проживания при sameAsRegistration=false

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 3

**Шаги:**

1. Убедиться, что чекбокс "Адрес проживания совпадает" включен
2. Убедиться, что поля адреса проживания скрыты
3. Снять чекбокс "Адрес проживания совпадает"

**Ожидаемый результат:**

- Появились поля адреса проживания (регион, город, улица, дом, квартира, индекс)
- Поля обязательны для заполнения

---

### TC-COND-009: Управление массивом имущества чекбоксом hasProperty

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 5

**Шаги:**

1. Убедиться, что чекбокс "У меня есть имущество" выключен
2. Убедиться, что секция имущества скрыта
3. Включить чекбокс "У меня есть имущество"

**Ожидаемый результат:**

- Появилась секция для добавления имущества
- Можно добавить элемент в массив properties

---

### TC-COND-010: Очистка массива имущества при выключении чекбокса

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Добавлено 2 объекта имущества

**Шаги:**

1. Выключить чекбокс "У меня есть имущество"
2. Снова включить чекбокс

**Ожидаемый результат:**

- Массив имущества очищен
- Секция пустая, можно добавлять заново

---

### TC-COND-011: Управление массивом существующих кредитов

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 5

**Шаги:**

1. Включить чекбокс "У меня есть другие кредиты"

**Ожидаемый результат:**

- Появилась секция для добавления кредитов
- Можно добавить элемент в массив existingLoans

---

### TC-COND-012: Управление массивом созаемщиков

**Приоритет:** High
**Категория:** Условные поля
**Предусловия:** Форма открыта на шаге 5

**Шаги:**

1. Включить чекбокс "Добавить созаемщика"

**Ожидаемый результат:**

- Появилась секция для добавления созаемщиков
- Можно добавить элемент в массив coBorrowers

---

## 4. Вычисляемые поля (Computed Fields)

### TC-COMP-001: Автоматический расчет процентной ставки

**Приоритет:** High
**Категория:** Вычисляемые поля
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Выбрать тип кредита "Потребительский"
2. Проверить процентную ставку
3. Сменить тип на "Ипотека"
4. Проверить процентную ставку

**Ожидаемый результат:**

- Процентная ставка автоматически рассчитана
- Ставка различается для разных типов кредита
- Поле readonly (нельзя редактировать вручную)

---

### TC-COMP-002: Автоматический расчет ежемесячного платежа

**Приоритет:** Critical
**Категория:** Вычисляемые поля
**Предусловия:** Форма открыта на шаге 1

**Шаги:**

1. Ввести сумму кредита: 1000000
2. Ввести срок: 12 месяцев
3. Проверить значение ежемесячного платежа
4. Изменить сумму на 2000000
5. Проверить обновление платежа

**Ожидаемый результат:**

- Ежемесячный платеж рассчитан по аннуитетной формуле
- Платеж обновляется при изменении суммы/срока/ставки
- Поле readonly

---

### TC-COMP-003: Автоматический расчет первоначального взноса (ипотека)

**Приоритет:** High
**Категория:** Вычисляемые поля
**Предусловия:** Выбран тип кредита "Ипотека"

**Шаги:**

1. Ввести стоимость недвижимости: 10000000
2. Проверить первоначальный взнос

**Ожидаемый результат:**

- Первоначальный взнос = 2000000 (20% от стоимости)
- Поле readonly
- При изменении стоимости взнос пересчитывается

---

### TC-COMP-004: Вычисление полного имени

**Приоритет:** Medium
**Категория:** Вычисляемые поля
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести фамилию: "Иванов"
2. Ввести имя: "Иван"
3. Ввести отчество: "Иванович"
4. Проверить поле fullName

**Ожидаемый результат:**

- fullName = "Иванов Иван Иванович"
- Поле readonly
- Обновляется при изменении любого компонента ФИО

---

### TC-COMP-005: Вычисление возраста из даты рождения

**Приоритет:** High
**Категория:** Вычисляемые поля
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести дату рождения: "1990-05-15"
2. Проверить поле age

**Ожидаемый результат:**

- Возраст рассчитан корректно (разница с текущей датой)
- Поле readonly
- Обновляется при изменении даты рождения

---

### TC-COMP-006: Вычисление общего дохода

**Приоритет:** High
**Категория:** Вычисляемые поля
**Предусловия:** Форма открыта на шаге 4

**Шаги:**

1. Ввести ежемесячный доход: 100000
2. Ввести дополнительный доход: 20000
3. Проверить поле totalIncome

**Ожидаемый результат:**

- totalIncome = 120000
- Поле readonly
- Обновляется при изменении любого дохода

---

### TC-COMP-007: Вычисление процента платежа от дохода

**Приоритет:** High
**Категория:** Вычисляемые поля
**Предусловия:** Заполнены сумма, срок кредита и доход

**Шаги:**

1. Установить сумму кредита для платежа 50000/мес
2. Установить доход: 100000
3. Проверить paymentToIncomeRatio

**Ожидаемый результат:**

- paymentToIncomeRatio = 50%
- Поле readonly
- Обновляется при изменении платежа или дохода

---

### TC-COMP-008: Вычисление дохода созаемщиков

**Приоритет:** Medium
**Категория:** Вычисляемые поля
**Предусловия:** Добавлены 2 созаемщика

**Шаги:**

1. Добавить созаемщика с доходом 50000
2. Добавить созаемщика с доходом 30000
3. Проверить поле coBorrowersIncome

**Ожидаемый результат:**

- coBorrowersIncome = 80000
- Поле readonly
- Обновляется при изменении доходов созаемщиков

---

## 5. Зависимости и каскадные эффекты

### TC-DEP-001: Загрузка моделей авто при изменении марки

**Приоритет:** High
**Категория:** Зависимости
**Предусловия:** Выбран тип "Автокредит"

**Шаги:**

1. Ввести марку автомобиля: "Toyota"
2. Дождаться 300ms (debounce)
3. Проверить загрузку моделей

**Ожидаемый результат:**

- Отображается индикатор загрузки
- Загружен список моделей Toyota
- Можно выбрать модель из списка

---

### TC-DEP-002: Очистка модели при смене марки

**Приоритет:** High
**Категория:** Зависимости
**Предусловия:** Выбрана марка "Toyota" и модель "Camry"

**Шаги:**

1. Изменить марку на "Honda"
2. Дождаться загрузки моделей

**Ожидаемый результат:**

- Поле модели очищено
- Загружен список моделей Honda
- Предыдущее значение "Camry" удалено

---

### TC-DEP-003: Загрузка городов при выборе региона

**Приоритет:** High
**Категория:** Зависимости
**Предусловия:** Форма открыта на шаге 3

**Шаги:**

1. Ввести регион: "Московская область"
2. Проверить загрузку городов

**Ожидаемый результат:**

- Загружен список городов Московской области
- Можно выбрать город из списка

---

### TC-DEP-004: Очистка города при смене региона

**Приоритет:** High
**Категория:** Зависимости
**Предусловия:** Выбран регион и город

**Шаги:**

1. Изменить регион на другой
2. Проверить поле города

**Ожидаемый результат:**

- Поле города очищено
- Загружены города нового региона

---

### TC-DEP-005: Копирование адреса регистрации в адрес проживания

**Приоритет:** High
**Категория:** Зависимости
**Предусловия:** Чекбокс sameAsRegistration=true

**Шаги:**

1. Заполнить адрес регистрации
2. Убедиться, что чекбокс включен
3. Проверить, что адрес проживания скопирован

**Ожидаемый результат:**

- Все поля адреса проживания содержат значения из адреса регистрации
- При изменении адреса регистрации адрес проживания обновляется

---

### TC-DEP-006: Каскадный пересчет при изменении дохода

**Приоритет:** High
**Категория:** Зависимости
**Предусловия:** Заполнены сумма кредита и доход

**Шаги:**

1. Изменить ежемесячный доход
2. Проверить totalIncome
3. Проверить paymentToIncomeRatio

**Ожидаемый результат:**

- totalIncome пересчитан
- paymentToIncomeRatio пересчитан
- Валидация обновлена (предупреждение при > 50%)

---

### TC-DEP-007: Каскадный эффект при смене типа кредита

**Приоритет:** High
**Категория:** Зависимости
**Предусловия:** Заполнена форма с типом "Ипотека"

**Шаги:**

1. Сменить тип на "Потребительский"
2. Проверить все зависимые поля

**Ожидаемый результат:**

- Поля ипотеки скрыты и очищены
- Процентная ставка пересчитана
- Ежемесячный платеж пересчитан

---

## 6. Кросс-валидация

### TC-CROSS-001: Стаж на текущем месте не больше общего стажа

**Приоритет:** High
**Категория:** Кросс-валидация
**Предусловия:** Форма открыта на шаге 4

**Шаги:**

1. Ввести общий стаж: 24 месяца
2. Ввести стаж на текущем месте: 36 месяцев
3. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Стаж на текущем месте не может превышать общий стаж"
- Переход заблокирован

---

### TC-CROSS-002: Первоначальный взнос минимум 20% от стоимости

**Приоритет:** High
**Категория:** Кросс-валидация
**Предусловия:** Тип кредита "Ипотека"

**Шаги:**

1. Ввести стоимость недвижимости: 10000000
2. Попытаться ввести первоначальный взнос: 1000000 (10%)

**Ожидаемый результат:**

- Поле readonly, нельзя ввести вручную
- Автоматически рассчитано 20% = 2000000

---

### TC-CROSS-003: Остаток задолженности не больше суммы кредита

**Приоритет:** High
**Категория:** Кросс-валидация
**Предусловия:** Добавлен существующий кредит

**Шаги:**

1. Ввести сумму кредита: 500000
2. Ввести остаток задолженности: 600000
3. Попытаться сохранить

**Ожидаемый результат:**

- Отображается ошибка "Остаток не может превышать сумму кредита"
- Валидация не пройдена

---

### TC-CROSS-004: Сумма ипотеки не превышает (стоимость - взнос)

**Приоритет:** High
**Категория:** Кросс-валидация
**Предусловия:** Тип кредита "Ипотека"

**Шаги:**

1. Ввести стоимость: 5000000
2. Первоначальный взнос автоматически: 1000000
3. Ввести сумму кредита: 4500000 (больше 4000000)

**Ожидаемый результат:**

- Отображается ошибка "Сумма кредита не может превышать стоимость за вычетом взноса"
- Переход заблокирован

---

### TC-CROSS-005: Возраст заемщика от 18 до 70 лет

**Приоритет:** Critical
**Категория:** Кросс-валидация
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести дату рождения, дающую возраст 17 лет
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Возраст должен быть от 18 до 70 лет"
- Переход заблокирован

---

### TC-CROSS-006: Процент платежа от дохода не более 50%

**Приоритет:** Critical
**Категория:** Кросс-валидация
**Предусловия:** Заполнены сумма кредита и доход

**Шаги:**

1. Установить параметры так, чтобы платеж был 60000
2. Установить доход: 100000 (платеж = 60%)
3. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Отображается ошибка "Платеж не должен превышать 50% от дохода"
- Переход заблокирован или показано предупреждение

---

### TC-CROSS-007: Предупреждение при высокой долговой нагрузке (>40%)

**Приоритет:** Medium
**Категория:** Кросс-валидация
**Предусловия:** paymentToIncomeRatio > 40%

**Шаги:**

1. Установить параметры так, чтобы paymentToIncomeRatio = 45%

**Ожидаемый результат:**

- Отображается предупреждение "Высокая долговая нагрузка"
- Переход разрешен (это предупреждение, не ошибка)

---

### TC-CROSS-008: Предупреждение при возрасте > 60 лет

**Приоритет:** Medium
**Категория:** Кросс-валидация
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести дату рождения, дающую возраст 62 года

**Ожидаемый результат:**

- Отображается предупреждение "Могут потребоваться дополнительные гарантии"
- Переход разрешен

---

### TC-CROSS-009: Предупреждение при малом стаже на текущем месте (<3 мес)

**Приоритет:** Low
**Категория:** Кросс-валидация
**Предусловия:** Форма открыта на шаге 4

**Шаги:**

1. Ввести стаж на текущем месте: 2 месяца

**Ожидаемый результат:**

- Отображается предупреждение "Малый стаж на текущем месте работы"
- Переход разрешен

---

## 7. Динамическая загрузка данных

### TC-LOAD-001: Загрузка справочников при инициализации формы

**Приоритет:** Critical
**Категория:** Динамическая загрузка
**Предусловия:** Форма не загружена

**Шаги:**

1. Открыть форму
2. Наблюдать за загрузкой

**Ожидаемый результат:**

- Отображается индикатор загрузки
- Справочники загружены (банки, типы имущества, и т.д.)
- Форма готова к использованию

---

### TC-LOAD-002: Загрузка данных заявки по ID

**Приоритет:** Critical
**Категория:** Динамическая загрузка
**Предусловия:** Существует заявка с ID='1'

**Шаги:**

1. Открыть форму с applicationId='1'
2. Дождаться загрузки

**Ожидаемый результат:**

- Отображается индикатор загрузки
- Данные заявки загружены
- Все поля предзаполнены

---

### TC-LOAD-003: Параллельная загрузка данных и справочников

**Приоритет:** High
**Категория:** Динамическая загрузка
**Предусловия:** Форма с applicationId

**Шаги:**

1. Открыть форму с applicationId
2. Наблюдать за загрузкой

**Ожидаемый результат:**

- Данные заявки и справочники загружаются параллельно
- Общее время загрузки оптимизировано

---

### TC-LOAD-004: Debounce при загрузке моделей авто

**Приоритет:** High
**Категория:** Динамическая загрузка
**Предусловия:** Тип кредита "Автокредит"

**Шаги:**

1. Быстро вводить марку автомобиля: "T", "To", "Toy", "Toyo", "Toyota"
2. Наблюдать за запросами

**Ожидаемый результат:**

- Запрос отправлен только один раз (после 300ms паузы)
- Не было множественных запросов при каждом символе

---

### TC-LOAD-005: Загрузка городов по региону

**Приоритет:** High
**Категория:** Динамическая загрузка
**Предусловия:** Форма открыта на шаге 3

**Шаги:**

1. Выбрать регион
2. Наблюдать за загрузкой городов

**Ожидаемый результат:**

- Отображается индикатор загрузки
- Загружены города выбранного региона
- Выпадающий список городов заполнен

---

## 8. Навигация между шагами

### TC-NAV-001: Переход на следующий шаг при валидных данных

**Приоритет:** Critical
**Категория:** Навигация
**Предусловия:** Шаг 1 заполнен корректно

**Шаги:**

1. Заполнить все обязательные поля шага 1
2. Нажать "Далее"

**Ожидаемый результат:**

- Выполнен переход на шаг 2
- Индикатор прогресса обновлен
- Данные шага 1 сохранены

---

### TC-NAV-002: Блокировка перехода при невалидных данных

**Приоритет:** Critical
**Категория:** Навигация
**Предусловия:** Шаг 1 заполнен с ошибками

**Шаги:**

1. Оставить обязательные поля пустыми
2. Нажать "Далее"

**Ожидаемый результат:**

- Переход заблокирован
- Отображены ошибки валидации
- Фокус на первом ошибочном поле

---

### TC-NAV-003: Возврат на предыдущий шаг без потери данных

**Приоритет:** Critical
**Категория:** Навигация
**Предусловия:** Заполнены шаги 1 и 2, находимся на шаге 2

**Шаги:**

1. Нажать "Назад"
2. Проверить данные шага 1
3. Нажать "Далее"
4. Проверить данные шага 2

**Ожидаемый результат:**

- Выполнен возврат на шаг 1
- Данные шага 1 сохранены
- Данные шага 2 сохранены после возврата

---

### TC-NAV-004: Индикатор прогресса отражает текущий шаг

**Приоритет:** High
**Категория:** Навигация
**Предусловия:** Форма открыта

**Шаги:**

1. Проверить индикатор на шаге 1
2. Перейти на шаг 2
3. Проверить индикатор
4. Вернуться на шаг 1
5. Проверить индикатор

**Ожидаемый результат:**

- Индикатор корректно показывает текущий шаг
- Пройденные шаги отмечены
- Непройденные шаги видны, но не активны

---

### TC-NAV-005: Прямая навигация к пройденному шагу

**Приоритет:** Medium
**Категория:** Навигация
**Предусловия:** Пройдены шаги 1-4, находимся на шаге 4

**Шаги:**

1. Кликнуть на индикатор шага 2

**Ожидаемый результат:**

- Выполнен переход на шаг 2
- Данные всех шагов сохранены

---

### TC-NAV-006: Запрет перехода к непройденным шагам

**Приоритет:** Medium
**Категория:** Навигация
**Предусловия:** Находимся на шаге 1

**Шаги:**

1. Попытаться кликнуть на индикатор шага 4

**Ожидаемый результат:**

- Переход заблокирован
- Остаемся на шаге 1

---

## 9. Работа с массивами (ArrayNode)

### TC-ARR-001: Добавление элемента в массив имущества

**Приоритет:** High
**Категория:** Работа с массивами
**Предусловия:** Включен чекбокс "У меня есть имущество"

**Шаги:**

1. Нажать кнопку "Добавить имущество"
2. Заполнить тип имущества: "Квартира"
3. Заполнить описание
4. Заполнить оценочную стоимость

**Ожидаемый результат:**

- Добавлен новый элемент в массив properties
- Форма элемента отображается корректно
- Данные сохраняются

---

### TC-ARR-002: Удаление элемента из массива имущества

**Приоритет:** High
**Категория:** Работа с массивами
**Предусловия:** В массиве properties 2 элемента

**Шаги:**

1. Нажать кнопку удаления для первого элемента

**Ожидаемый результат:**

- Элемент удален из массива
- Остался 1 элемент
- Индексы обновлены

---

### TC-ARR-003: Валидация каждого элемента массива

**Приоритет:** High
**Категория:** Работа с массивами
**Предусловия:** Добавлен элемент имущества с пустыми полями

**Шаги:**

1. Добавить элемент имущества
2. Оставить обязательные поля пустыми
3. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Валидация выполнена для элемента массива
- Ошибки отображены для пустых полей
- Переход заблокирован

---

### TC-ARR-004: Добавление нескольких существующих кредитов

**Приоритет:** Medium
**Категория:** Работа с массивами
**Предусловия:** Включен чекбокс "У меня есть другие кредиты"

**Шаги:**

1. Добавить кредит 1: банк "Сбербанк", сумма 500000
2. Добавить кредит 2: банк "ВТБ", сумма 300000
3. Добавить кредит 3: банк "Альфа", сумма 200000

**Ожидаемый результат:**

- Все 3 кредита добавлены
- Данные каждого кредита сохранены корректно
- Массив existingLoans содержит 3 элемента

---

### TC-ARR-005: Добавление созаемщика с полными данными

**Приоритет:** High
**Категория:** Работа с массивами
**Предусловия:** Включен чекбокс "Добавить созаемщика"

**Шаги:**

1. Добавить созаемщика
2. Заполнить личные данные (ФИО, дата рождения)
3. Заполнить телефон и email
4. Заполнить родство и доход

**Ожидаемый результат:**

- Созаемщик добавлен
- Вложенная форма personalData работает корректно
- coBorrowersIncome обновлен

---

### TC-ARR-006: Максимальное количество элементов в массиве

**Приоритет:** Low
**Категория:** Работа с массивами
**Предусловия:** Форма открыта на шаге 5

**Шаги:**

1. Добавить 10+ объектов имущества

**Ожидаемый результат:**

- Все элементы добавлены или отображено ограничение
- Форма работает стабильно
- Нет проблем с производительностью

---

## 10. Обработка ошибок

### TC-ERR-001: Ошибка загрузки данных заявки

**Приоритет:** Critical
**Категория:** Обработка ошибок
**Предусловия:** API возвращает ошибку 404

**Шаги:**

1. Открыть форму с несуществующим applicationId='999'

**Ожидаемый результат:**

- Отображается экран ошибки
- Сообщение "Заявка не найдена"
- Кнопка "Попробовать снова" или возврат

---

### TC-ERR-002: Ошибка загрузки справочников

**Приоритет:** High
**Категория:** Обработка ошибок
**Предусловия:** API справочников недоступен

**Шаги:**

1. Открыть форму при недоступном API

**Ожидаемый результат:**

- Отображается экран ошибки
- Сообщение о проблеме загрузки
- Кнопка "Попробовать снова"

---

### TC-ERR-003: Ошибка отправки формы

**Приоритет:** Critical
**Категория:** Обработка ошибок
**Предусловия:** Форма заполнена, API отправки недоступен

**Шаги:**

1. Заполнить форму полностью
2. Нажать "Отправить заявку"
3. API возвращает ошибку 500

**Ожидаемый результат:**

- Отображается сообщение об ошибке
- Данные формы не потеряны
- Можно повторить отправку

---

### TC-ERR-004: Отображение ошибок валидации на форме

**Приоритет:** High
**Категория:** Обработка ошибок
**Предусловия:** Форма с ошибками валидации

**Шаги:**

1. Оставить несколько обязательных полей пустыми
2. Попытаться перейти на следующий шаг

**Ожидаемый результат:**

- Все ошибочные поля подсвечены
- Текст ошибки отображается под каждым полем
- Фокус на первом ошибочном поле

---

### TC-ERR-005: Retry-механизм при сетевой ошибке

**Приоритет:** Medium
**Категория:** Обработка ошибок
**Предусловия:** Временная сетевая ошибка

**Шаги:**

1. Спровоцировать сетевую ошибку
2. Дождаться отображения ошибки
3. Нажать "Попробовать снова"

**Ожидаемый результат:**

- Запрос повторен
- При успехе данные загружены
- Состояние формы восстановлено

---

### TC-ERR-006: Ошибка загрузки моделей авто

**Приоритет:** Medium
**Категория:** Обработка ошибок
**Предусловия:** API моделей недоступен

**Шаги:**

1. Выбрать тип "Автокредит"
2. Ввести марку автомобиля
3. API моделей возвращает ошибку

**Ожидаемый результат:**

- Отображается сообщение об ошибке загрузки моделей
- Можно повторить или ввести модель вручную

---

## 11. Режимы формы

### TC-MODE-001: Режим создания (mode='create')

**Приоритет:** Critical
**Категория:** Режимы формы
**Предусловия:** Нет

**Шаги:**

1. Открыть форму без applicationId

**Ожидаемый результат:**

- Форма пустая
- Все поля редактируемые
- Значения по умолчанию установлены

---

### TC-MODE-002: Режим редактирования (mode='edit')

**Приоритет:** Critical
**Категория:** Режимы формы
**Предусловия:** Существует заявка

**Шаги:**

1. Открыть форму с applicationId в режиме редактирования

**Ожидаемый результат:**

- Форма предзаполнена данными
- Все поля редактируемые
- Можно изменять и сохранять

---

### TC-MODE-003: Режим просмотра (mode='view')

**Приоритет:** High
**Категория:** Режимы формы
**Предусловия:** Существует заявка

**Шаги:**

1. Открыть форму с applicationId в режиме просмотра
2. Попытаться изменить любое поле

**Ожидаемый результат:**

- Форма предзаполнена данными
- Все поля readonly
- Кнопка отправки скрыта

---

### TC-MODE-004: Переключение между режимами

**Приоритет:** Medium
**Категория:** Режимы формы
**Предусловия:** Форма загружена в режиме просмотра

**Шаги:**

1. Открыть форму в режиме view
2. Переключить в режим edit

**Ожидаемый результат:**

- Поля стали редактируемыми
- Данные сохранены
- Кнопка отправки появилась

---

## 12. Edge Cases

### TC-EDGE-001: Очень длинные значения в текстовых полях

**Приоритет:** Medium
**Категория:** Edge Cases
**Предусловия:** Форма открыта

**Шаги:**

1. Ввести в поле "Цель кредита" текст длиной 500 символов (максимум)
2. Попытаться ввести 501-й символ

**Ожидаемый результат:**

- Ввод ограничен 500 символами
- Отображается счетчик символов или предупреждение
- Данные сохраняются корректно

---

### TC-EDGE-002: Специальные символы в текстовых полях

**Приоритет:** Medium
**Категория:** Edge Cases
**Предусловия:** Форма открыта

**Шаги:**

1. Ввести в поле ФИО: "О'Коннор-Смит"
2. Ввести в поле адреса: 'ул. Победы, д. 1/2 "А"'

**Ожидаемый результат:**

- Специальные символы приняты
- Данные сохранены корректно
- Нет XSS-уязвимостей

---

### TC-EDGE-003: Нулевые значения в числовых полях

**Приоритет:** Medium
**Категория:** Edge Cases
**Предусловия:** Форма открыта на шаге 4

**Шаги:**

1. Ввести дополнительный доход: 0
2. Проверить валидацию

**Ожидаемый результат:**

- Значение 0 принято для необязательного поля
- totalIncome рассчитан корректно

---

### TC-EDGE-004: Отрицательные значения в числовых полях

**Приоритет:** Medium
**Категория:** Edge Cases
**Предусловия:** Форма открыта

**Шаги:**

1. Попытаться ввести сумму кредита: -100000

**Ожидаемый результат:**

- Отрицательное значение не принято или заменено на 0
- Отображается ошибка валидации

---

### TC-EDGE-005: Дата рождения в будущем

**Приоритет:** Medium
**Категория:** Edge Cases
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести дату рождения в будущем (2030-01-01)

**Ожидаемый результат:**

- Отображается ошибка валидации
- Переход заблокирован

---

### TC-EDGE-006: Дата рождения слишком давно

**Приоритет:** Low
**Категория:** Edge Cases
**Предусловия:** Форма открыта на шаге 2

**Шаги:**

1. Ввести дату рождения: 1900-01-01 (возраст > 100 лет)

**Ожидаемый результат:**

- Отображается ошибка или предупреждение
- Возраст > 70 блокирует заявку

---

### TC-EDGE-007: Быстрое переключение между шагами

**Приоритет:** Medium
**Категория:** Edge Cases
**Предусловия:** Форма с заполненными данными

**Шаги:**

1. Быстро нажать "Далее" 5 раз подряд
2. Быстро нажать "Назад" 5 раз подряд

**Ожидаемый результат:**

- Форма работает стабильно
- Данные не потеряны
- Нет ошибок в консоли

---

### TC-EDGE-008: Множественные клики на кнопку отправки

**Приоритет:** High
**Категория:** Edge Cases
**Предусловия:** Форма заполнена полностью

**Шаги:**

1. Быстро нажать "Отправить" 5 раз подряд

**Ожидаемый результат:**

- Отправлен только один запрос
- Кнопка заблокирована после первого клика
- Отображается индикатор загрузки

---

### TC-EDGE-009: Потеря соединения во время заполнения

**Приоритет:** Medium
**Категория:** Edge Cases
**Предусловия:** Форма частично заполнена

**Шаги:**

1. Заполнить шаги 1-3
2. Симулировать потерю соединения
3. Попытаться перейти на шаг 4

**Ожидаемый результат:**

- Локальные данные сохранены
- Отображается предупреждение об отсутствии соединения
- При восстановлении соединения можно продолжить

---

---

## 13. Производительность (Performance)

### TC-PERF-001: Время инициализации формы

**Приоритет:** High
**Категория:** Производительность
**Метрика:** Время от открытия до готовности формы
**Порог:** < 500ms (без загрузки данных), < 2000ms (с загрузкой)

**Сценарий:**

1. Измерить время от вызова компонента до первого рендера
2. Измерить время до полной готовности (все справочники загружены)

**Измерения:**

- First Contentful Paint: < 200ms
- Time to Interactive: < 500ms
- Полная загрузка с данными: < 2000ms

**Инструменты:** Performance API, React Profiler

---

### TC-PERF-002: Время отклика при вводе в поля

**Приоритет:** Critical
**Категория:** Производительность
**Метрика:** Задержка между нажатием клавиши и отображением символа
**Порог:** < 16ms (60fps)

**Сценарий:**

1. Открыть форму
2. Начать вводить текст в поле "Цель кредита"
3. Измерить время отклика на каждое нажатие

**Измерения:**

- Input latency: < 16ms
- Нет пропущенных кадров (no frame drops)

**Инструменты:** Chrome DevTools Performance, React Profiler

---

### TC-PERF-003: Время пересчета вычисляемых полей

**Приоритет:** High
**Категория:** Производительность
**Метрика:** Время от изменения зависимого поля до обновления computed field
**Порог:** < 50ms

**Сценарий:**

1. Изменить сумму кредита
2. Измерить время до обновления monthlyPayment
3. Повторить для других computed fields

**Измерения:**

- Пересчет одного поля: < 10ms
- Каскадный пересчет (цепочка зависимостей): < 50ms

**Инструменты:** Performance API, console.time()

---

### TC-PERF-004: Время валидации шага перед переходом

**Приоритет:** High
**Категория:** Производительность
**Метрика:** Время от нажатия "Далее" до перехода/отображения ошибок
**Порог:** < 100ms

**Сценарий:**

1. Заполнить шаг с 10+ полями
2. Нажать "Далее"
3. Измерить время валидации

**Измерения:**

- Валидация шага 1 (10 полей): < 50ms
- Валидация шага 2 (13 полей с масками): < 100ms
- Валидация с кросс-валидацией: < 100ms

**Инструменты:** Performance API

---

### TC-PERF-005: Производительность при большом количестве элементов в массивах

**Приоритет:** High
**Категория:** Производительность
**Метрика:** Время рендера, FPS при скролле
**Порог:** FPS > 30 при 20 элементах

**Сценарий:**

1. Добавить 20 объектов имущества
2. Измерить время добавления каждого
3. Измерить FPS при скролле списка

**Измерения:**

- Время добавления элемента: < 100ms
- FPS при скролле: > 30fps
- Время удаления элемента: < 50ms

**Инструменты:** React Profiler, Chrome DevTools Performance

---

### TC-PERF-006: Время переключения между шагами

**Приоритет:** High
**Категория:** Производительность
**Метрика:** Время от клика до отображения нового шага
**Порог:** < 100ms

**Сценарий:**

1. Заполнить шаг 1
2. Измерить время перехода на шаг 2
3. Повторить для всех переходов

**Измерения:**

- Переход вперед: < 100ms
- Переход назад: < 100ms
- Прямой переход к шагу: < 100ms

**Инструменты:** Performance API

---

### TC-PERF-007: FPS при быстром вводе с масками

**Приоритет:** High
**Категория:** Производительность
**Метрика:** Кадры в секунду при быстром вводе
**Порог:** > 60fps (без frame drops)

**Сценарий:**

1. Открыть поле телефона с маской
2. Быстро вводить цифры (имитация автозаполнения)
3. Измерить FPS

**Измерения:**

- FPS при вводе: > 60fps
- Нет залипаний курсора
- Маска применяется без задержек

**Инструменты:** Chrome DevTools Performance

---

### TC-PERF-008: Производительность debounce-логики

**Приоритет:** Medium
**Категория:** Производительность
**Метрика:** Количество запросов, время отклика UI
**Порог:** 1 запрос на изменение после debounce

**Сценарий:**

1. Вводить марку авто посимвольно: "Toyota"
2. Считать количество API запросов
3. Измерить время до получения результата

**Измерения:**

- Количество запросов: 1 (после паузы 300ms)
- UI отклик во время ввода: < 16ms
- Время от паузы до результата: < 500ms (включая API)

**Инструменты:** Network DevTools, Performance API

---

### TC-PERF-009: Память при длительной работе с формой

**Приоритет:** High
**Категория:** Производительность
**Метрика:** Рост heap memory
**Порог:** < 10% роста за 10 циклов заполнения

**Сценарий:**

1. Зафиксировать начальный heap size
2. Заполнить форму полностью
3. Очистить форму
4. Повторить 10 раз
5. Принудительный GC
6. Зафиксировать финальный heap size

**Измерения:**

- Начальный heap: X MB
- Финальный heap после GC: < X \* 1.1 MB
- Нет постоянного роста

**Инструменты:** Chrome DevTools Memory

---

## 14. Утечки памяти (Memory Leaks)

### TC-MEM-001: Утечки при монтировании/размонтировании формы

**Приоритет:** Critical
**Категория:** Утечки памяти
**Тип утечки:** DOM nodes, event listeners, subscriptions

**Сценарий:**

1. Зафиксировать начальный heap snapshot
2. Монтировать форму
3. Размонтировать форму
4. Повторить 20 раз
5. Принудительный garbage collection
6. Зафиксировать финальный heap snapshot

**Критерии прохождения:**

- Heap size не вырос более чем на 5% после GC
- Нет detached DOM nodes от формы
- Количество EventListener не увеличилось

**Инструменты:** Chrome DevTools Memory, memlab

---

### TC-MEM-002: Утечки при переключении между шагами

**Приоритет:** High
**Категория:** Утечки памяти
**Тип утечки:** subscriptions, observers, timers

**Сценарий:**

1. Зафиксировать heap snapshot
2. Переключиться между всеми 6 шагами 10 раз
3. Вернуться на шаг 1
4. GC
5. Зафиксировать heap snapshot

**Критерии прохождения:**

- Нет утечек подписок на изменения формы
- Нет оставшихся observers от предыдущих шагов
- Heap не вырос значительно

**Инструменты:** Chrome DevTools Memory

---

### TC-MEM-003: Утечки при динамической загрузке данных

**Приоритет:** High
**Категория:** Утечки памяти
**Тип утечки:** pending promises, abort controllers

**Сценарий:**

1. Начать вводить марку авто
2. Быстро переключиться на другой тип кредита (отмена запроса)
3. Повторить 20 раз
4. GC и проверка heap

**Критерии прохождения:**

- Все отмененные запросы очищены
- Нет pending promises в памяти
- AbortController очищены

**Инструменты:** Chrome DevTools Memory, Network

---

### TC-MEM-004: Утечки при добавлении/удалении элементов массивов

**Приоритет:** High
**Категория:** Утечки памяти
**Тип утечки:** detached DOM nodes, closures

**Сценарий:**

1. Зафиксировать heap snapshot
2. Добавить 10 объектов имущества
3. Удалить все 10 объектов
4. Повторить 5 раз
5. GC и проверка

**Критерии прохождения:**

- Нет detached DOM nodes от удаленных элементов
- Нет утечек closure от обработчиков событий
- Heap вернулся к начальному уровню

**Инструменты:** Chrome DevTools Memory

---

### TC-MEM-005: Утечки при смене типа кредита

**Приоритет:** High
**Категория:** Утечки памяти
**Тип утечки:** conditional components, subscriptions

**Сценарий:**

1. Зафиксировать heap snapshot
2. Переключить тип: Потребительский → Ипотека → Автокредит → Потребительский
3. Повторить 10 раз
4. GC и проверка

**Критерии прохождения:**

- Условные поля полностью удалены из памяти
- Нет подписок от скрытых полей
- Heap стабилен

**Инструменты:** Chrome DevTools Memory

---

### TC-MEM-006: Утечки при изменении режима формы

**Приоритет:** Medium
**Категория:** Утечки памяти
**Тип утечки:** component state, event handlers

**Сценарий:**

1. Зафиксировать heap snapshot
2. Переключить режим: create → edit → view → create
3. Повторить 10 раз
4. GC и проверка

**Критерии прохождения:**

- Нет утечек состояния от предыдущих режимов
- Event handlers очищены корректно
- Heap стабилен

**Инструменты:** Chrome DevTools Memory

---

### TC-MEM-007: Рост heap при длительной работе

**Приоритет:** Critical
**Категория:** Утечки памяти
**Тип утечки:** общая проверка на утечки

**Сценарий:**

1. Зафиксировать начальный heap
2. Выполнить полный цикл работы с формой:
   - Заполнить все 6 шагов
   - Добавить массивы (имущество, кредиты, созаемщики)
   - Изменить тип кредита несколько раз
   - Отправить форму
3. Очистить форму
4. Повторить 10 раз
5. GC и финальная проверка

**Критерии прохождения:**

- Heap не вырос более чем на 10% от начального
- Нет линейного роста памяти
- После GC память возвращается к baseline

**Инструменты:** Chrome DevTools Memory, timeline recording

---

### TC-MEM-008: Очистка debounce-таймеров при размонтировании

**Приоритет:** High
**Категория:** Утечки памяти
**Тип утечки:** timers, setTimeout

**Сценарий:**

1. Начать вводить марку авто (запуск debounce)
2. Немедленно размонтировать форму (до истечения debounce)
3. Проверить, что таймер очищен
4. Повторить 20 раз

**Критерии прохождения:**

- Нет выполнения callback после размонтирования
- Нет ошибок "setState on unmounted component"
- Таймеры очищены в cleanup

**Инструменты:** Console logs, React DevTools

---

### TC-MEM-009: Очистка подписок на computed fields

**Приоритет:** High
**Категория:** Утечки памяти
**Тип утечки:** subscriptions, effects

**Сценарий:**

1. Зафиксировать количество активных подписок
2. Изменить поля, вызывающие пересчет computed fields
3. Размонтировать форму
4. Проверить, что подписки очищены

**Критерии прохождения:**

- Все подписки на computed fields отписаны
- Нет orphan subscriptions
- Effects cleanup выполнен

**Инструменты:** React DevTools, custom logging

---

### TC-MEM-010: Утечки closure в callbacks

**Приоритет:** Medium
**Категория:** Утечки памяти
**Тип утечки:** closures, stale references

**Сценарий:**

1. Зафиксировать heap snapshot
2. Выполнить действия, создающие callbacks:
   - onChange для каждого поля
   - onClick для кнопок
   - Обработчики валидации
3. Размонтировать форму
4. GC и проверка

**Критерии прохождения:**

- Closures не удерживают ссылки на размонтированные компоненты
- Нет stale state в callbacks
- Heap очищен после GC

**Инструменты:** Chrome DevTools Memory, Heap snapshot comparison

---

## Сводка тест-кейсов

| Категория          | Количество | Приоритет Critical | Приоритет High | Приоритет Medium | Приоритет Low |
| ------------------ | ---------- | ------------------ | -------------- | ---------------- | ------------- |
| Happy Path         | 5          | 4                  | 1              | 0                | 0             |
| Валидация          | 15         | 3                  | 10             | 2                | 0             |
| Условные поля      | 12         | 4                  | 8              | 0                | 0             |
| Computed Fields    | 8          | 1                  | 6              | 1                | 0             |
| Зависимости        | 7          | 0                  | 7              | 0                | 0             |
| Кросс-валидация    | 9          | 2                  | 5              | 2                | 0             |
| Загрузка данных    | 5          | 2                  | 3              | 0                | 0             |
| Навигация          | 6          | 2                  | 2              | 2                | 0             |
| Массивы            | 6          | 0                  | 5              | 0                | 1             |
| Ошибки             | 6          | 2                  | 2              | 2                | 0             |
| Режимы формы       | 4          | 2                  | 1              | 1                | 0             |
| Edge Cases         | 9          | 0                  | 2              | 6                | 1             |
| Производительность | 9          | 1                  | 7              | 1                | 0             |
| Утечки памяти      | 10         | 2                  | 7              | 1                | 0             |
| **ИТОГО**          | **111**    | **25**             | **66**         | **18**           | **2**         |
